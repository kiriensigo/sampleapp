# 012: Netlifyãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®š

## æ¦‚è¦
Netlifyã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šã€æœ¬ç•ªç’°å¢ƒæ§‹ç¯‰ã€CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­å®š

## ä½œæ¥­å†…å®¹

### Netlifyè¨­å®š
- [x] Netlifyã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆãƒ»è¨­å®š
- [x] GitHubãƒªãƒã‚¸ãƒˆãƒªé€£æº
- [x] ãƒ“ãƒ«ãƒ‰è¨­å®š
- [x] ç’°å¢ƒå¤‰æ•°è¨­å®š
- [ ] ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³è¨­å®šï¼ˆå°†æ¥ç”¨ï¼‰

### ãƒ“ãƒ«ãƒ‰æœ€é©åŒ–
- [x] `next.config.ts`æœ¬ç•ªç”¨è¨­å®š
- [x] ç”»åƒæœ€é©åŒ–è¨­å®šï¼ˆBGGç”»åƒãƒ‰ãƒ¡ã‚¤ãƒ³å¯¾å¿œï¼‰
- [x] WebP/AVIFæœ€é©åŒ–
- [x] ãƒãƒ³ãƒ‰ãƒ«åˆ†æãƒ»æœ€é©åŒ–

### Netlifyè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
- [x] `netlify.toml`ä½œæˆãƒ»è¨­å®šå®Œäº†
- [x] ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒ«ãƒ¼ãƒ«è¨­å®šï¼ˆSPAå¯¾å¿œï¼‰
- [x] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼è¨­å®š
- [x] ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ€é©åŒ–è¨­å®š
- [x] Functionsè¨­å®š

### ç’°å¢ƒå¤‰æ•°è¨­å®š
- [x] Supabaseæœ¬ç•ªURLãƒ»ã‚­ãƒ¼
- [x] BGG APIè¨­å®š
- [x] ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
- [ ] OAuthæœ¬ç•ªã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDï¼ˆå°†æ¥å®Ÿè£…ï¼‰

### Netlify Functions
- [ ] BGG API ãƒ—ãƒ­ã‚­ã‚·é–¢æ•°
- [ ] Webhookå—ä¿¡é–¢æ•°
- [ ] å®šæœŸå®Ÿè¡Œé–¢æ•°ï¼ˆcronï¼‰
- [ ] ç”»åƒå‡¦ç†é–¢æ•°

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š
- [x] HTTPSå¼·åˆ¶è¨­å®šï¼ˆNetlifyè‡ªå‹•ï¼‰
- [x] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆX-Frame-Optionsã€X-Content-Type-Optionsç­‰ï¼‰
- [x] CORSè¨­å®š
- [ ] CSPï¼ˆContent Security Policyï¼‰â†’å°†æ¥å®Ÿè£…

### CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
- [ ] GitHub Actionsè¨­å®š
- [ ] è‡ªå‹•ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
- [ ] ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤è‡ªå‹•åŒ–
- [ ] ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®š

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- [x] CDNè¨­å®šï¼ˆNetlifyè‡ªå‹•ï¼‰
- [x] ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ï¼ˆé™çš„ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»APIåˆ¥è¨­å®šï¼‰
- [x] åœ§ç¸®è¨­å®š
- [x] ç”»åƒæœ€é©åŒ–ï¼ˆWebP/AVIFï¼‰

### ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ãƒ»åˆ†æ
- [ ] Netlify Analyticsè¨­å®š
- [ ] ã‚¨ãƒ©ãƒ¼ç›£è¦–è¨­å®š
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–
- [ ] ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š

## è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

### `netlify.toml`
```toml
[build]
  publish = "out"
  command = "npm run build"

[build.environment]
  NODE_VERSION = "18"

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

[functions]
  directory = "netlify/functions"

[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "strict-origin-when-cross-origin"
```

### `next.config.js`ï¼ˆæœ¬ç•ªç”¨ï¼‰
```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  output: 'export',
  trailingSlash: true,
  images: {
    unoptimized: true,
    domains: ['cf.geekdo-images.com'],
  },
  env: {
    NEXT_PUBLIC_APP_URL: process.env.NEXT_PUBLIC_APP_URL,
  },
}

module.exports = nextConfig
```

### GitHub Actionsï¼ˆ`.github/workflows/deploy.yml`ï¼‰
```yaml
name: Deploy to Netlify
on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
      - run: npm ci
      - run: npm run lint
      - run: npm run test
      - run: npm run build

  deploy:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    steps:
      - uses: actions/checkout@v3
      - name: Deploy to Netlify
        uses: netlify/actions/build@master
        with:
          publish-dir: './out'
        env:
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
          NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}
```

## ç’°å¢ƒå¤‰æ•°ï¼ˆNetlifyè¨­å®šï¼‰
- [x] `NEXT_PUBLIC_SUPABASE_URL`
- [x] `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- [x] `SUPABASE_SERVICE_ROLE_KEY`
- [ ] `GOOGLE_CLIENT_ID`ï¼ˆå°†æ¥å®Ÿè£…ï¼‰
- [ ] `GOOGLE_CLIENT_SECRET`ï¼ˆå°†æ¥å®Ÿè£…ï¼‰
- [ ] `TWITTER_CLIENT_ID`ï¼ˆå°†æ¥å®Ÿè£…ï¼‰
- [ ] `TWITTER_CLIENT_SECRET`ï¼ˆå°†æ¥å®Ÿè£…ï¼‰
- [x] `BGG_API_BASE_URL`
- [x] `NEXT_PUBLIC_APP_URL`

## ãƒ‡ãƒ—ãƒ­ã‚¤å‰ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- [x] å…¨ãƒ†ã‚¹ãƒˆãŒé€šé
- [x] ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ãŒãªã„
- [x] ç’°å¢ƒå¤‰æ•°ãŒæ­£ã—ãè¨­å®š
- [x] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šç¢ºèª
- [ ] OAuthè¨­å®šç¢ºèªï¼ˆå°†æ¥å®Ÿè£…ï¼‰
- [x] ç”»åƒãƒ»ã‚¢ã‚»ãƒƒãƒˆç¢ºèª

## å—ã‘å…¥ã‚Œæ¡ä»¶
- [x] Netlifyã§æ­£å¸¸ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã‚‹
- [x] æœ¬ç•ªç’°å¢ƒã§å…¨æ©Ÿèƒ½ãŒå‹•ä½œã™ã‚‹
- [x] HTTPSæ¥ç¶šãŒæ­£å¸¸ã«å‹•ä½œ
- [x] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒè‰¯å¥½
- [x] ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã„ãªã„
- [ ] CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒå‹•ä½œã™ã‚‹ï¼ˆå°†æ¥å®Ÿè£…ï¼‰

## æƒ³å®šä½œæ¥­æ™‚é–“
4-6æ™‚é–“

## é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- `netlify.toml`
- `next.config.js`
- `.github/workflows/deploy.yml`
- `netlify/functions/*`

## ğŸ‰ ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†çŠ¶æ³

### âœ… å®Œäº†æ¸ˆã¿é …ç›®
- **æœ¬ç•ªã‚µã‚¤ãƒˆ**: https://bgrq.netlify.app ã§ç¨¼åƒä¸­
- **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«**: netlify.toml, next.config.ts å®Œå…¨è¨­å®š
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: HTTPSã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼å®Œå‚™
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: CDNã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€ç”»åƒæœ€é©åŒ–å®Œäº†
- **ç’°å¢ƒå¤‰æ•°**: Supabaseã€BGG APIè¨­å®šå®Œäº†

### ğŸ“‹ ç¾åœ¨ã®çŠ¶æ³
BGRã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯**æœ¬ç•ªç’°å¢ƒãƒ¬ãƒ‡ã‚£**çŠ¶æ…‹ã§ã€Netlifyã§æ­£å¸¸ç¨¼åƒä¸­ã§ã™ã€‚

## å‚™è€ƒ
æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤ã¯å®Œäº†æ¸ˆã¿ã€‚ç¶™ç¶šçš„ãªãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã¨æ©Ÿèƒ½è¿½åŠ ã‚’å®Ÿæ–½ä¸­ã€‚